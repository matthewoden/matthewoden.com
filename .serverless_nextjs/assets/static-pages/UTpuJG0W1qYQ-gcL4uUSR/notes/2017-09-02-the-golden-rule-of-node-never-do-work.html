<!DOCTYPE html><html lang="en"><head><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="192x192" href="/static/favicons/favicon-192x192.png"/><link rel="icon" type="image/png" sizes="512x512" href="/static/favicons/favicon-512x512.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" content="#000000"/><link rel="alternate" type="application/rss+xml" href="/index.xml"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/><link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&amp;display=swap"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&amp;display=swap" media="print"/><noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&amp;display=swap"/></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/fonts/KaTeX_Main-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/fonts/KaTeX_Math-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/fonts/KaTeX_Size2-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/fonts/KaTeX_Size4-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous"/><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if(!e)return localStorage.setItem('theme','light'),d.add('light');if("system"===e){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="https://twitter.com/matthewoden"/><meta name="twitter:creator" content="https://twitter.com/matthewoden"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="600"/><meta property="og:locale" content="en-us"/><meta name="author" content="Matthew Oden Potter"/><title>Node isn&#x27;t where you do work. – MatthewOden.com</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="Push work to other systems, and let node coordinate your flow."/><meta property="og:url" content="https://matthewoden.com/notes/2017-09-02-the-golden-rule-of-node-never-do-work"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2017-09-02T00:00:00.000Z"/><meta property="article:modified_time" content="2017-09-02T00:00:00.000Z"/><meta property="article:author" content="https://matthewoden.com/about"/><meta property="article:tag" content="node"/><meta property="article:tag" content="architecture"/><meta property="og:title" content="Node isn&#x27;t where you do work."/><meta property="og:description" content="Push work to other systems, and let node coordinate your flow."/><meta property="og:image" content="https://matthewoden.com/static/images/face.png"/><meta property="og:image:alt" content="Node isn&#x27;t where you do work."/><link rel="canonical" href="https://matthewoden.com/notes/2017-09-02-the-golden-rule-of-node-never-do-work"/><meta name="twitter:image" content="https://matthewoden.com/static/images/face.png"/><script type="application/ld+json">{
    "@context": "https://schema.org",
    "@type": "Article",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https://matthewoden.com/notes/2017-09-02-the-golden-rule-of-node-never-do-work"
    },
    "headline": "Node isn't where you do work.",
    "image": [
      "[object Object]"
     ],
    "datePublished": "2017-09-02T00:00:00.000Z",
    "dateModified": "2017-09-02T00:00:00.000Z",
    "author": {"@type": "Person","name": "Matthew Oden Potter"},
    "publisher": {
      "@type": "Organization",
      "name": "Matthew Oden Potter",
      "logo": {
        "@type": "ImageObject",
        "url": "undefined"
      }
    },
    "description": "Push work to other systems, and let node coordinate your flow."
  }</script><meta name="next-head-count" content="28"/><link rel="preload" href="/_next/static/css/40c272ad66e3b5045f49.css" as="style"/><link rel="stylesheet" href="/_next/static/css/40c272ad66e3b5045f49.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-a837451738e9bc430433.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.3001023d071dd3bbe4b7.js" as="script"/><link rel="preload" href="/_next/static/chunks/9adc93607ca194fe33d5fd75450ccdb7397e9788.9fbf4a83f1e2236cbcd2.js" as="script"/><link rel="preload" href="/_next/static/chunks/36831c9346731e813c333dbc96f1dae7f0140181.0be75cecccf812d630d3.js" as="script"/><link rel="preload" href="/_next/static/chunks/3a4d373e4f729ad3d1487c5b24727311a83f72b6.56bb5d8090d059ec8b57.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-443197cdf2ed8c4b363a.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/notes/%5Bslug%5D-771ca72895c067407b5c.js" as="script"/></head><body class="antialiased bg-gray-900 text-white"><div id="__next"><div class="max-w-3xl px-4 mx-auto sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex flex-col justify-between h-screen"><header class="flex items-center justify-between py-10"><div><a href="/"><div class="flex items-center justify-between"><div class="h-6 text-2xl font-semibold">MatthewOden.com</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium sm:p-4 text-gray-100" href="/notes">Notes</a><a class="p-1 font-medium sm:p-4 text-gray-100" href="/tags">Tags</a><a class="p-1 font-medium sm:p-4 text-gray-100" href="/about">About</a></div><div class="sm:hidden"><button type="button" class="w-8 h-8 ml-1 mr-1 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed w-full h-full top-24 right-0 bg-gray-800 opacity-95 z-10 transform ease-in-out duration-300 translate-x-full"><button type="button" aria-label="toggle modal" class="fixed w-full h-full cursor-auto focus:outline-none"></button><nav class="fixed h-full mt-8"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-100" href="/notes">Notes</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-100" href="/tags">Tags</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-100" href="/about">About</a></div></nav></div></div></div></header><main class="mb-auto"><div class="max-w-3xl px-4 mx-auto sm:px-6 xl:max-w-5xl xl:px-0"><article><div class="xl:divide-y xl:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-400"><time dateTime="2017-09-02">Friday, September 1, 2017</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Node isn&#x27;t where you do work.</h1></div></div></header><div class="pb-8 divide-y xl:divide-y-0 divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:pt-11 xl:border-b  xl:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 xl:block sm:space-x-12 xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><img src="/static/images/face.png" alt="avatar" class="w-10 h-10 rounded-full"/><dl class="text-sm font-medium leading-5 whitespace-nowrap"><dt class="sr-only">Name</dt><dd class="text-gray-100">Matthew Oden Potter</dd><dt class="sr-only">Twitter</dt><dd><a target="_blank" rel="noopener noreferrer" href="https://twitter.com/matthewoden" class="text-blue-500 hover:text-blue-400">@matthewoden</a></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-700 xl:pb-0 xl:col-span-3 xl:row-span-2"><div class="pt-10 pb-8 prose prose-dark max-w-none"><div><p>The other day in the <a target="_blank" rel="noopener noreferrer" href="https://stl-tech.slack.com/messages/C0VTQRYEA/">STL #Node slack channel</a>, a user
asked how to join two JSON payloads together. They queried a list of inventories (which had
users), and a list of users (who were attached to inventories), and wanted
to know the best way to combine them in Javascript.</p><p>I quickly threw together a method for zipping/reducing across collections<a href="#1"><sup>1</sup></a>, but
also warned them about breaking the <em>Golden Rule of Node</em>:</p><blockquote><p><strong>Don&#x27;t <em>do</em> work in node. <em>Describe</em> work in node.</strong></p></blockquote><h2 id="doing-work-is-data-manipulation"><a href="#doing-work-is-data-manipulation" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a><em>Doing</em> work is data manipulation</h2><p>Node servers are, for the most part, single-threaded applications. They
depend heavily on non-blocking I/O for performance. Every time you rework data
as part of your server&#x27;s response, you&#x27;re hold up the queue of incoming requests.</p><p>Of course, it&#x27;s possible to spin up <a target="_blank" rel="noopener noreferrer" href="https://nodejs.org/api/child_process.html">child processes</a>
and delegate this work to another thread. But <a target="_blank" rel="noopener noreferrer" href="https://github.com/nodejs/node/issues/3145">sending data back and forth over IPC is slow</a>,
and requires serializing/unserializing on each process, which blocks both threads
during that time. It would seem that this kind of delegation just
creates more work.<a href="#2"><sup>2</sup></a></p><h2 id="describing-work-is-message-passing"><a href="#describing-work-is-message-passing" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a><em>Describing</em> work is message-passing</h2><p>Node shines as a message broker, transforming small requests into streaming
replies. Think of your node app as a middle-manager, gathering requirements,
handling bad requests, and delegating responsibility.</p><h3 id="practices-and-patterns-for-describing-work"><a href="#practices-and-patterns-for-describing-work" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Practices and patterns for describing work:</h3><ul><li><p>Avoid formatting the incoming request. Clients should pass in data exactly as
you need it.</p></li><li><p>Get your data from the database exactly as your client expects it.
If you need the data sorted, make that part of the query. If you need it
aliased, and grouped? Do it in the query. Your database is always going to be
faster at organizing data than your server.</p></li><li><p>Leave database responses as they are. If you&#x27;ve asked for exactly what you
need, there&#x27;s no point in mapping, filtering, or sorting the results.</p></li><li><p>Use static, parameterized queries whenever possible. Custom string-building/
query-building is just more logic to keep track of, and more work to be done
on every call.</p></li><li><p>If you don&#x27;t have any say over the format of the data (maybe you&#x27;re
calling another API), then minimize the work you have to do. Use streams and
sequences to manipulate the data as it arrives, rather than all at once.</p></li></ul><p>In short, a valid request from the client should map to a static, parameterized
query. The database&#x27;s response should be attach onto a parameterized reply.
Outside of basic validation, your server shouldn&#x27;t ever care about the
data passing through it.</p><hr/><small><a target="_blank" rel="noopener noreferrer" id="1"></a><sup>1</sup> Regardless of whether or not something&#x27;s a good idea, sometimes you just need to get things done.<a target="_blank" rel="noopener noreferrer" id="2"></a><sup>2</sup> This is part of why scaling out a Node service is typically done by spinning up more servers to run in parallel, rather than a using a single server that manages multiple threads.</small></div></div><div class="pt-6 pb-6 text-sm text-gray-700 text-gray-300"><a target="_blank" rel="nofollow" href="https://mobile.twitter.com/search?q=https%3A%2F%2Fmatthewoden.com%2Fnotes%2F2017-09-02-the-golden-rule-of-node-never-do-work">Discuss on Twitter</a> • <a target="_blank" rel="noopener noreferrer" href="https://github.com/matthewoden/matthewoden.com/blob/master/data/notes/2017-09-02-the-golden-rule-of-node-never-do-work.md">View on GitHub</a></div></div><footer><div class="text-sm font-medium leading-5 xl:divide-y divide-gray-700 xl:col-start-1 xl:row-start-2"><div class="py-4 xl:py-8"><h2 class="text-xs tracking-wide uppercase text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-xs font-medium text-blue-500 lowercase hover:text-blue-400" href="/tags/node">node</a><a class="mr-3 text-xs font-medium text-blue-500 lowercase hover:text-blue-400" href="/tags/architecture">architecture</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs tracking-wide  uppercase text-gray-400">Previous Article</h2><div class="text-blue-500 hover:text-blue-400"><a href="/notes/2017-08-15-common-problems-with-npm-enterprise">Common problems when using NPM Enterprise.</a></div></div><div><h2 class="text-xs tracking-wide uppercase text-gray-400">Next Article</h2><div class="text-blue-500 hover:text-blue-400"><a href="/notes/2017-09-04-single-node-ssl-aws-elastic-beanstalk">Setting up SSL for a single-instance deploy on Elastic Beanstalk, with Docker</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-blue-500 hover:text-blue-400" href="/notes">← Back to Notes</a></div></footer></div></div></article></div></main><footer><div class="flex flex-col items-center mt-16"><div class="flex mb-3 space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:heymatthewoden@gmail.com"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-200 hover:text-blue-400 h-6 w-6"><path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path><path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/matthewoden"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-200 hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://twitter.com/matthewoden"><span class="sr-only">twitter</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-200 hover:text-blue-400 h-6 w-6"><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/in/matthew-potter-8194998a/"><span class="sr-only">linkedin</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-200 hover:text-blue-400 h-6 w-6"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path></svg></a></div><div class="flex mb-2 space-x-2 text-sm text-gray-400"><div>Matthew Oden Potter</div><div> • </div><div>© 2017</div><div> • </div><a href="/">MatthewOden.com</a></div><div class="mb-8 text-sm text-gray-400"> </div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":{"compiledSource":"\"use strict\";\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i \u003c arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i \u003c sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) \u003e= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i \u003c sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) \u003e= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar layoutProps = {};\nvar MDXLayout = \"wrapper\";\n\nfunction MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"The other day in the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://stl-tech.slack.com/messages/C0VTQRYEA/\"\n  }), \"STL #Node slack channel\"), \", a user\\nasked how to join two JSON payloads together. They queried a list of inventories (which had\\nusers), and a list of users (who were attached to inventories), and wanted\\nto know the best way to combine them in Javascript.\"), mdx(\"p\", null, \"I quickly threw together a method for zipping/reducing across collections\", mdx(\"a\", {\n    href: \"#1\"\n  }, mdx(\"sup\", null, \"1\")), \", but\\nalso warned them about breaking the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Golden Rule of Node\"), \":\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Don't \", mdx(\"em\", {\n    parentName: \"strong\"\n  }, \"do\"), \" work in node. \", mdx(\"em\", {\n    parentName: \"strong\"\n  }, \"Describe\"), \" work in node.\"))), mdx(\"h2\", {\n    \"id\": \"doing-work-is-data-manipulation\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#doing-work-is-data-manipulation\",\n    \"aria-hidden\": \"true\",\n    \"tabIndex\": -1\n  }), mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"icon icon-link\"\n  }))), mdx(\"em\", {\n    parentName: \"h2\"\n  }, \"Doing\"), \" work is data manipulation\"), mdx(\"p\", null, \"Node servers are, for the most part, single-threaded applications. They\\ndepend heavily on non-blocking I/O for performance. Every time you rework data\\nas part of your server's response, you're hold up the queue of incoming requests.\"), mdx(\"p\", null, \"Of course, it's possible to spin up \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://nodejs.org/api/child_process.html\"\n  }), \"child processes\"), \"\\nand delegate this work to another thread. But \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/nodejs/node/issues/3145\"\n  }), \"sending data back and forth over IPC is slow\"), \",\\nand requires serializing/unserializing on each process, which blocks both threads\\nduring that time. It would seem that this kind of delegation just\\ncreates more work.\", mdx(\"a\", {\n    href: \"#2\"\n  }, mdx(\"sup\", null, \"2\"))), mdx(\"h2\", {\n    \"id\": \"describing-work-is-message-passing\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#describing-work-is-message-passing\",\n    \"aria-hidden\": \"true\",\n    \"tabIndex\": -1\n  }), mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"icon icon-link\"\n  }))), mdx(\"em\", {\n    parentName: \"h2\"\n  }, \"Describing\"), \" work is message-passing\"), mdx(\"p\", null, \"Node shines as a message broker, transforming small requests into streaming\\nreplies. Think of your node app as a middle-manager, gathering requirements,\\nhandling bad requests, and delegating responsibility.\"), mdx(\"h3\", {\n    \"id\": \"practices-and-patterns-for-describing-work\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"href\": \"#practices-and-patterns-for-describing-work\",\n    \"aria-hidden\": \"true\",\n    \"tabIndex\": -1\n  }), mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"icon icon-link\"\n  }))), \"Practices and patterns for describing work:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Avoid formatting the incoming request. Clients should pass in data exactly as\\nyou need it.\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Get your data from the database exactly as your client expects it.\\nIf you need the data sorted, make that part of the query. If you need it\\naliased, and grouped? Do it in the query. Your database is always going to be\\nfaster at organizing data than your server.\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Leave database responses as they are. If you've asked for exactly what you\\nneed, there's no point in mapping, filtering, or sorting the results.\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Use static, parameterized queries whenever possible. Custom string-building/\\nquery-building is just more logic to keep track of, and more work to be done\\non every call.\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"If you don't have any say over the format of the data (maybe you're\\ncalling another API), then minimize the work you have to do. Use streams and\\nsequences to manipulate the data as it arrives, rather than all at once.\"))), mdx(\"p\", null, \"In short, a valid request from the client should map to a static, parameterized\\nquery. The database's response should be attach onto a parameterized reply.\\nOutside of basic validation, your server shouldn't ever care about the\\ndata passing through it.\"), mdx(\"hr\", null), mdx(\"small\", null, mdx(\"a\", {\n    id: \"1\"\n  }), mdx(\"sup\", null, \"1\"), \" Regardless of whether or not something's a good idea, sometimes you just need to get things done.\", mdx(\"a\", {\n    id: \"2\"\n  }), mdx(\"sup\", null, \"2\"), \" This is part of why scaling out a Node service is typically done by spinning up more servers to run in parallel, rather than a using a single server that manages multiple threads.\"));\n}\n\n;\nMDXContent.isMDXComponent = true;","renderedOutput":"\u003cp\u003eThe other day in the \u003ca target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://stl-tech.slack.com/messages/C0VTQRYEA/\"\u003eSTL #Node slack channel\u003c/a\u003e, a user\nasked how to join two JSON payloads together. They queried a list of inventories (which had\nusers), and a list of users (who were attached to inventories), and wanted\nto know the best way to combine them in Javascript.\u003c/p\u003e\u003cp\u003eI quickly threw together a method for zipping/reducing across collections\u003ca href=\"#1\"\u003e\u003csup\u003e1\u003c/sup\u003e\u003c/a\u003e, but\nalso warned them about breaking the \u003cem\u003eGolden Rule of Node\u003c/em\u003e:\u003c/p\u003e\u003cblockquote\u003e\u003cp\u003e\u003cstrong\u003eDon\u0026#x27;t \u003cem\u003edo\u003c/em\u003e work in node. \u003cem\u003eDescribe\u003c/em\u003e work in node.\u003c/strong\u003e\u003c/p\u003e\u003c/blockquote\u003e\u003ch2 id=\"doing-work-is-data-manipulation\"\u003e\u003ca href=\"#doing-work-is-data-manipulation\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e\u003cem\u003eDoing\u003c/em\u003e work is data manipulation\u003c/h2\u003e\u003cp\u003eNode servers are, for the most part, single-threaded applications. They\ndepend heavily on non-blocking I/O for performance. Every time you rework data\nas part of your server\u0026#x27;s response, you\u0026#x27;re hold up the queue of incoming requests.\u003c/p\u003e\u003cp\u003eOf course, it\u0026#x27;s possible to spin up \u003ca target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://nodejs.org/api/child_process.html\"\u003echild processes\u003c/a\u003e\nand delegate this work to another thread. But \u003ca target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://github.com/nodejs/node/issues/3145\"\u003esending data back and forth over IPC is slow\u003c/a\u003e,\nand requires serializing/unserializing on each process, which blocks both threads\nduring that time. It would seem that this kind of delegation just\ncreates more work.\u003ca href=\"#2\"\u003e\u003csup\u003e2\u003c/sup\u003e\u003c/a\u003e\u003c/p\u003e\u003ch2 id=\"describing-work-is-message-passing\"\u003e\u003ca href=\"#describing-work-is-message-passing\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e\u003cem\u003eDescribing\u003c/em\u003e work is message-passing\u003c/h2\u003e\u003cp\u003eNode shines as a message broker, transforming small requests into streaming\nreplies. Think of your node app as a middle-manager, gathering requirements,\nhandling bad requests, and delegating responsibility.\u003c/p\u003e\u003ch3 id=\"practices-and-patterns-for-describing-work\"\u003e\u003ca href=\"#practices-and-patterns-for-describing-work\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003ePractices and patterns for describing work:\u003c/h3\u003e\u003cul\u003e\u003cli\u003e\u003cp\u003eAvoid formatting the incoming request. Clients should pass in data exactly as\nyou need it.\u003c/p\u003e\u003c/li\u003e\u003cli\u003e\u003cp\u003eGet your data from the database exactly as your client expects it.\nIf you need the data sorted, make that part of the query. If you need it\naliased, and grouped? Do it in the query. Your database is always going to be\nfaster at organizing data than your server.\u003c/p\u003e\u003c/li\u003e\u003cli\u003e\u003cp\u003eLeave database responses as they are. If you\u0026#x27;ve asked for exactly what you\nneed, there\u0026#x27;s no point in mapping, filtering, or sorting the results.\u003c/p\u003e\u003c/li\u003e\u003cli\u003e\u003cp\u003eUse static, parameterized queries whenever possible. Custom string-building/\nquery-building is just more logic to keep track of, and more work to be done\non every call.\u003c/p\u003e\u003c/li\u003e\u003cli\u003e\u003cp\u003eIf you don\u0026#x27;t have any say over the format of the data (maybe you\u0026#x27;re\ncalling another API), then minimize the work you have to do. Use streams and\nsequences to manipulate the data as it arrives, rather than all at once.\u003c/p\u003e\u003c/li\u003e\u003c/ul\u003e\u003cp\u003eIn short, a valid request from the client should map to a static, parameterized\nquery. The database\u0026#x27;s response should be attach onto a parameterized reply.\nOutside of basic validation, your server shouldn\u0026#x27;t ever care about the\ndata passing through it.\u003c/p\u003e\u003chr/\u003e\u003csmall\u003e\u003ca target=\"_blank\" rel=\"noopener noreferrer\" id=\"1\"\u003e\u003c/a\u003e\u003csup\u003e1\u003c/sup\u003e Regardless of whether or not something\u0026#x27;s a good idea, sometimes you just need to get things done.\u003ca target=\"_blank\" rel=\"noopener noreferrer\" id=\"2\"\u003e\u003c/a\u003e\u003csup\u003e2\u003c/sup\u003e This is part of why scaling out a Node service is typically done by spinning up more servers to run in parallel, rather than a using a single server that manages multiple threads.\u003c/small\u003e","scope":{}},"frontMatter":{"wordCount":478,"readingTime":{"text":"3 min read","minutes":2.38,"time":142799.99999999997,"words":476},"slug":"2017-09-02-the-golden-rule-of-node-never-do-work","fileName":"2017-09-02-the-golden-rule-of-node-never-do-work.md","title":"Node isn't where you do work.","date":"2017-09-02","summary":"Push work to other systems, and let node coordinate your flow.","tags":["node","architecture"]}},"prev":{"title":"Common problems when using NPM Enterprise.","date":"2017-08-15","tags":["node","config"],"summary":"A better developer experience when using private registries","draft":false,"slug":"2017-08-15-common-problems-with-npm-enterprise"},"next":{"title":"Setting up SSL for a single-instance deploy on Elastic Beanstalk, with Docker","date":"2017-09-04","tags":["devops","docker"],"draft":false,"summary":"A step by step guide to have https on your personal projects.","slug":"2017-09-04-single-node-ssl-aws-elastic-beanstalk"}},"__N_SSG":true},"page":"/notes/[slug]","query":{"slug":"2017-09-02-the-golden-rule-of-node-never-do-work"},"buildId":"UTpuJG0W1qYQ-gcL4uUSR","runtimeConfig":{},"nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-0b9b5722f0d6cfa79d03.js"></script><script src="/_next/static/chunks/main-a837451738e9bc430433.js" async=""></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/commons.3001023d071dd3bbe4b7.js" async=""></script><script src="/_next/static/chunks/9adc93607ca194fe33d5fd75450ccdb7397e9788.9fbf4a83f1e2236cbcd2.js" async=""></script><script src="/_next/static/chunks/36831c9346731e813c333dbc96f1dae7f0140181.0be75cecccf812d630d3.js" async=""></script><script src="/_next/static/chunks/3a4d373e4f729ad3d1487c5b24727311a83f72b6.56bb5d8090d059ec8b57.js" async=""></script><script src="/_next/static/chunks/pages/_app-443197cdf2ed8c4b363a.js" async=""></script><script src="/_next/static/chunks/pages/notes/%5Bslug%5D-771ca72895c067407b5c.js" async=""></script><script src="/_next/static/UTpuJG0W1qYQ-gcL4uUSR/_buildManifest.js" async=""></script><script src="/_next/static/UTpuJG0W1qYQ-gcL4uUSR/_ssgManifest.js" async=""></script></body></html>